<!doctype html>
<html>
  <head>
    <title>DrawPDF - Review & Export</title>
    <meta charset="utf-8" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
    />
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f8f9fa;
        display: flex;
        gap: 20px;
      }
      .panel {
        flex: 1;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        height: 90vh;
        overflow: auto;
      }
      h2 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
      }
      pre {
        background: #f4f4f4;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
      }
      button:hover {
        background: #0056b3;
      }
      #preview-frame {
        width: 100%;
        height: 500px;
        border: 1px solid #ddd;
        margin-top: 20px;
        background: #fff;
      }
    </style>
  </head>
  <body>
    <!-- Panel Tr√°i: Code H∆∞·ªõng D·∫´n -->
    <div class="panel" style="flex: 0 0 40%">
      <h2>üíª Review & Export Code</h2>
      <p>Quy tr√¨nh Review v√† Export th∆∞·ªùng ƒë∆∞·ª£c th·ª±c hi·ªán ·ªü b∆∞·ªõc cu·ªëi c√πng.</p>
      <p>ƒê·ªãnh nghƒ©a DrawPDF</p>
      <pre>
        <code class="language-javascript">
const DrawPDF = window.DrawPDF.default;
        </code>
      </pre>
      <h3>1. Parse HTML to Blueprint</h3>
      <p>
        N·∫øu b·∫°n ƒë√£ c√≥ chu·ªói HTML, s·ª≠ d·ª•ng h√†m <code>.parseHtml()</code> ƒë·ªÉ t·∫°o
        blueprint chu·∫©n.
      </p>
      <pre><code class="language-javascript">const html = `
                        <h1 style="color:darkblue">B√°o C√°o Review</h1>
                        <p>ƒê√¢y l√† file PDF ƒë∆∞·ª£c t·∫°o t·ª´ quy tr√¨nh <strong>Review & Export</strong>.</p>
                        <table style="width:100%; border-collapse: collapse;" border="1">
                            <tr style="background:#ddd;"><th>M·ª•c</th><th>Tr·∫°ng Th√°i</th></tr>
                            <tr><td>Code Review</td><td>Passed</td></tr>
                            <tr><td>Export Test</td><td>Success</td></tr>
                        </table>
                    `";
const blueprint = DrawPDF.parseHtml(html);</code></pre>

      <h3>2. (Optional) Review Blueprint</h3>
      <p>Blueprint l√† object JSON ch·ª©a c·∫•u tr√∫c v√† style ƒë√£ ƒë∆∞·ª£c parse.</p>
      <pre><code class="language-javascript">console.log(blueprint);</code></pre>
      <h3>3. If have blueprint data</h3>
      <p>
        N·∫øu b·∫°n ƒë√£ c√≥ blueprint data th√¨ kh√¥ng c·∫ßn parse l·∫°i html, b·∫°n c√≥ th·ªÉ s·ª≠
        d·ª•ng blueprint data tr·ª±c ti·∫øp.
      </p>
      <pre><code class="language-javascript">const blueprint = {
    "pages": [
        {
            "width": 595.28,
            "height": 841.89,
            "elements": [
                {
                    "type": "text",
                    "content": "B√°o C√°o Review",
                    "style": {
                        "fontSize": 24,
                        "fontWeight": "bold",
                        "color": "darkblue"
                    },
                    "x": 50,
                    "y": 50
                }
            ]
        }
    ]
};</code></pre>
      <p>
        B·∫°n c√≥ th·ªÉ set data v√†o c√°c bi·∫øn c·ªßa blueprint b·∫±ng c√°ch s·ª≠ d·ª•ng h√†m
        <code>setData</code>.
      </p>
      <p>H√†m r√∫t g·ªçn khi download file pdf v·ª´a set:</p>
      <pre><code class="language-javascript">const pdf = new DrawPDF();
pdf.setData(blueprint);
pdf.download('document-final.pdf');</code></pre>
      <p>set data binding to blueprint before create pdf</p>
      <pre><code class="language-javascript">
const pdf = new DrawPDF(); 
pdf.setData(blueprint);
pdf.render(data);
pdf.download('document-final.pdf');</code>
<span>or</span>
<code class="language-javascript">
const pdf = new DrawPDF();
pdf.setData(blueprint);
pdf.download('document-final.pdf', data);</code></pre>

      <h3>4. Export PDF</h3>
      <p>
        S·ª≠ d·ª•ng h√†m <code>downloadBlueprint</code> ƒë·ªÉ t·∫°o v√† t·∫£i file PDF t·ª´
        blueprint n√†y.
      </p>
      <pre><code class="language-javascript">await DrawPDF.downloadBlueprint(
    blueprint, 
    'document-final.pdf'
);</code>
<span>Or</span>
<code class="language-javascript">await DrawPDF.downloadBlueprint(
    blueprint, 
    'document-final.pdf',
    data
);</code></pre>

      <div
        style="
          margin-top: 30px;
          padding: 15px;
          background: #e9ecef;
          border-radius: 5px;
        "
      >
        <strong>Th·ª≠ Nghi·ªám:</strong><br />
        Nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ gi·∫£ l·∫≠p quy tr√¨nh Export m·ªôt m·∫´u c√≥ s·∫µn.
        <br />
        <button onclick="runDemoExport()">üöÄ Run Export Demo</button>
      </div>
    </div>

    <!-- Panel Ph·∫£i: K·∫øt qu·∫£ / Preview -->
    <div class="panel">
      <h2>üìÑ Review Preview</h2>
      <p>K·∫øt qu·∫£ PDF s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ho·∫∑c t·∫£i v·ªÅ.</p>
      <div
        id="status-log"
        style="color: #666; font-style: italic; margin-bottom: 15px"
      >
        Ready...
      </div>

      <!-- M·ªôt khung ƒë·ªÉ hi·ªÉn th·ªã editor ·∫©n ho·∫∑c preview n·∫øu c·∫ßn, ·ªü ƒë√¢y ta d√πng ƒë·ªÉ ch·ª©a instance ·∫©n ƒë·ªÉ generate -->
      <div id="hidden-editor" style="display: none"></div>
    </div>

    <script src="https://unpkg.com/masax-drawpdf@2.2.2/dist/drawpdf.standalone.umd.cjs"></script>
    <script src="../script/data.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>

    <script>
      const DrawPDF = window.DrawPDF.default;
      const statusLog = document.getElementById("status-log");

      function log(msg) {
        statusLog.innerHTML = `${new Date().toLocaleTimeString()} - ${msg}`;
      }

      async function runDemoExport() {
        try {
          log("ƒêang kh·ªüi t·∫°o Demo...");
          log("ƒêang t·∫£i Blueprint m·∫´u...");
          const blueprint = sampleBlueprint; // S·ª≠ d·ª•ng bi·∫øn global t·ª´ data.js
          console.log("Blueprint:", blueprint);
          log("ƒêang t·∫°o PDF...");
          console.log("Blueprint:", blueprint);
          log("ƒêang t·∫°o PDF...");

          // Demo download
          await DrawPDF.downloadBlueprint(blueprint, "review-export-demo.pdf");

          log("‚úÖ ƒê√£ xu·∫•t file PDF th√†nh c√¥ng!");
        } catch (error) {
          console.error(error);
          log("‚ùå L·ªói: " + error.message);
        }
      }

      window.runDemoExport = runDemoExport;
    </script>
  </body>
</html>
