<!doctype html>
<html>
  <head>
    <title>DrawPDF - Table Example</title>
    <meta charset="utf-8" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
    />
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f8f9fa;
        display: flex;
        gap: 20px;
      }
      .panel {
        flex: 1;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        height: 90vh;
        overflow: auto;
      }
      h2 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
      }
      pre {
        background: #f4f4f4;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
      }
      button:hover {
        background: #0056b3;
      }
      #editor {
        width: 100%;
        height: 100%;
        border: 1px solid #ddd;
        background: #fff;
      }
    </style>
  </head>
  <body>
    <!-- Panel Tr√°i: Code H∆∞·ªõng D·∫´n -->
    <div class="panel" style="flex: 0 0 40%">
      <h2>üíª Table Guide</h2>
      <p>
        DrawPDF h·ªó tr·ª£ hi·ªÉn th·ªã b·∫£ng bi·ªÉu ƒëa d·∫°ng t·ª´ HTML chu·∫©n. D∆∞·ªõi ƒë√¢y l√† c√°c
        t√≠nh nƒÉng ch√≠nh:
      </p>

      <h3>1. C·∫•u Tr√∫c B·∫£ng (Structure)</h3>
      <p>
        S·ª≠ d·ª•ng th·∫ª <code>&lt;table&gt;</code>, <code>&lt;thead&gt;</code>,
        <code>&lt;tbody&gt;</code>.
        <br />
        H·ªó tr·ª£ ƒë·∫ßy ƒë·ªß <strong>rowspan</strong> v√† <strong>colspan</strong> ƒë·ªÉ
        tr·ªôn √¥.
      </p>
      <pre><code class="language-html">&lt;table style="width:100%; border-collapse: collapse;"&gt;
  &lt;thead&gt;
    &lt;tr&gt;&lt;th colspan="2"&gt;Header Group&lt;/th&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;th&gt;Sub 1&lt;/th&gt;&lt;th&gt;Sub 2&lt;/th&gt;&lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;...&lt;/tbody&gt;
&lt;/table&gt;</code></pre>

      <h3>2. ƒê·ªãnh D·∫°ng (Styling)</h3>
      <p>DrawPDF nh·∫≠n di·ªán c√°c inline CSS sau:</p>
      <ul>
        <li>
          <strong>Borders:</strong> <code>border: 1px solid #000</code> (√°p d·ª•ng
          cho table ho·∫∑c td/th).
        </li>
        <li>
          <strong>Background:</strong> <code>background-color: #f0f0f0</code>.
        </li>
        <li>
          <strong>Alignment:</strong> <code>text-align: center/right</code>.
        </li>
        <li><strong>Padding:</strong> <code>padding: 5px</code>.</li>
        <li>
          <strong>Width:</strong> <code>width: 100%</code> ho·∫∑c pixel c·ªë ƒë·ªãnh.
        </li>
      </ul>

      <h3>3. B·∫£ng ƒê·ªông (Dynamic Code)</h3>
      <p>
        S·ª≠ d·ª•ng
        <strong>Code Block</strong> (<code>&lt;pre&gt;&lt;code&gt;</code>) v·ªõi
        <code>// eval</code> ƒë·ªÉ ch·∫°y JavaScript tr·ª±c ti·∫øp.
      </p>

      <h4>C√°c bi·∫øn c√≥ s·∫µn:</h4>
      <ul>
        <li>
          <code>pdf</code>: Instance c·ªßa <code>JsPdfService</code> (API v·∫Ω PDF
          ch√≠nh).
        </li>
        <li><code>data</code>: D·ªØ li·ªáu ƒë∆∞·ª£c truy·ªÅn v√†o (n·∫øu c√≥).</li>
      </ul>

      <h4>V√≠ d·ª• ƒë·∫ßy ƒë·ªß:</h4>
      <pre><code class="language-javascript">// eval
// 1. D·ªØ li·ªáu m·∫´u (Header c√≥ th·ªÉ l√† 1 chi·ªÅu ho·∫∑c 2 chi·ªÅu)
const headers = [
  [{ content: 'Danh S√°ch Nh√¢n S·ª±', colSpan: 3, styles: { halign: 'center' } }], // Row 1
  ['STT', 'H·ªç T√™n', 'Ph√≤ng Ban'] // Row 2
];

const rows = [
  [1, 'Nguy·ªÖn VƒÉn A', 'K·ªπ Thu·∫≠t'],
  [2, 'Tr·∫ßn Th·ªã B', 'Nh√¢n S·ª±'],
  [3, 'L√™ VƒÉn C', 'Kinh Doanh']
];

// 2. V·∫Ω b·∫£ng
pdf.addTable(headers, rows, {
  theme: 'grid', // 'striped' | 'grid' | 'plain'
  styles: { 
    fontSize: 10,
    cellPadding: 4,
    font: 'Roboto'
  },
  headStyles: {
    fillColor: [41, 128, 185],
    textColor: 255,
    fontStyle: 'bold'
  },
  columnStyles: {
    0: { cellWidth: 15, halign: 'center' }, // C·ªôt STT
    2: { fontStyle: 'italic' } // C·ªôt Ph√≤ng Ban
  },
  margin: { top: 10 }
});

// 3. Th√™m ghi ch√∫ b√™n d∆∞·ªõi
pdf.addText("T·ªïng s·ªë: " + rows.length + " nh√¢n s·ª±.", 15, pdf.currentY + 5, {
    fontStyle: 'italic',
    color: [100, 100, 100]
});</code></pre>

      <div
        style="
          margin-top: 30px;
          padding: 15px;
          background: #e9ecef;
          border-radius: 5px;
        "
      >
        <strong>Th·ª≠ Nghi·ªám:</strong><br />
        Nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ t·∫°o b·∫£ng d·ªØ li·ªáu m·∫´u.
        <br />
        <button onclick="runDemo()" style="width: 100%; margin-bottom: 10px">
          üöÄ Load All Table Types
        </button>
        <button onclick="reviewPdf()" style="width: 100%; background: #28a745">
          üìÑ Review PDF
        </button>
      </div>
    </div>

    <!-- Panel Ph·∫£i: Editor -->
    <div class="panel">
      <h2>üìÑ Live Editor</h2>
      <div id="editor"></div>
    </div>

    <script src="https://unpkg.com/masax-drawpdf@2.2.2/dist/drawpdf.standalone.umd.cjs"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>

    <script>
      let pdfInstance = null;

      document.addEventListener("DOMContentLoaded", async function () {
        const DrawPDF = window.DrawPDF.default;
        pdfInstance = await DrawPDF.create("#editor");
      });

      function runDemo() {
        if (!pdfInstance) return;

        const thStyle = "text-align: center;";
        const tdStyle = "border: 1px solid #ddd;";
        const centerStyle = "text-align: center;";
        const boldStyle = "font-weight: bold;";

        const html = `
            <!-- 1. MERGED HEADER TABLE -->
            <div style="font-size: 16px; font-weight: bold; color: #333; margin-bottom: 10px; border-bottom: 2px solid #007bff; display: inline-block;">1. B·∫£ng Tr·ªôn C·ªôt (Merged Headers)</div>
            <table style="width:100%; margin-bottom: 20px;">
                <thead>
                    <tr>
                        <th rowspan="2" style="${thStyle}">STT</th>
                        <th rowspan="2" style="${thStyle}">H·ªç v√† T√™n</th>
                        <th colspan="3" style="${thStyle}">ƒêi·ªÉm C√°c M√¥n</th>
                    </tr>
                    <tr>
                        <th style="${thStyle}">To√°n</th>
                        <th style="${thStyle}">L√Ω</th>
                        <th style="${thStyle}">H√≥a</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="${tdStyle} ${centerStyle}">1</td>
                        <td style="${tdStyle}">Nguy·ªÖn VƒÉn A</td>
                        <td style="${tdStyle} ${centerStyle}">8.5</td>
                        <td style="${tdStyle} ${centerStyle}">7.0</td>
                        <td style="${tdStyle} ${centerStyle}">9.0</td>
                    </tr>
                    <tr>
                        <td style="${tdStyle} ${centerStyle}">2</td>
                        <td style="${tdStyle}">Tr·∫ßn Th·ªã B</td>
                        <td style="${tdStyle} ${centerStyle}">9.0</td>
                        <td style="${tdStyle} ${centerStyle}">9.5</td>
                        <td style="${tdStyle} ${centerStyle}">8.5</td>
                    </tr>
                </tbody>
            </table>

            <br>

            <!-- 2. INVOICE STYLE TABLE -->
            <div style="font-size: 16px; font-weight: bold; color: #333; margin-bottom: 10px; border-bottom: 2px solid #28a745; display: inline-block;">2. B·∫£ng H√≥a ƒê∆°n (Invoice Style)</div>
            <table style="width:100%; border-collapse: collapse; margin-bottom: 20px;">
                <thead>
                    <tr style="background-color: #28a745; color: white;">
                        <th style="padding: 10px;">M√¥ T·∫£</th>
                        <th style="padding: 10px; text-align: right;">S·ªë L∆∞·ª£ng</th>
                        <th style="padding: 10px; text-align: right;">ƒê∆°n Gi√°</th>
                        <th style="padding: 10px; text-align: right;">Th√†nh Ti·ªÅn</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">Thi·∫øt k·∫ø Website</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">1</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">$500.00</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">$500.00</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">Hosting (1 NƒÉm)</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">1</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">$120.00</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">$120.00</td>
                    </tr>
                     <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">B·∫£o Tr√¨</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">2</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">$50.00</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">$100.00</td>
                    </tr>
                    <tr style="background-color: #f9f9f9; font-weight: bold;">
                        <td colspan="3" style="padding: 10px; text-align: right;">T·ªïng C·ªông:</td>
                        <td style="padding: 10px; text-align: right; color: #dc3545;">$720.00</td>
                    </tr>
                </tbody>
            </table>

            <br>

            <!-- 3. COMPLEX MERGE TABLE -->
            <div style="font-size: 16px; font-weight: bold; color: #333; margin-bottom: 10px; border-bottom: 2px solid #dc3545; display: inline-block;">3. B·∫£ng Ph·ª©c T·∫°p (Rowspan & Colspan)</div>
            <table border="1" style="width:100%; border-collapse: collapse; border: 1px solid #000;">
                <tr style="background-color: #ccc;">
                    <th rowspan="2">Khu V·ª±c</th>
                    <th colspan="2">Doanh S·ªë (T·ª∑ VNƒê)</th>
                    <th rowspan="2">Ghi Ch√∫</th>
                </tr>
                <tr style="background-color: #eee;">
                    <th>Q1</th>
                    <th>Q2</th>
                </tr>
                <tr>
                    <td rowspan="2" style="${centerStyle}">Mi·ªÅn B·∫Øc</td>
                    <td style="${centerStyle}">150</td>
                    <td style="${centerStyle}">200</td>
                    <td>TƒÉng tr∆∞·ªüng ƒë·ªÅu</td>
                </tr>
                <tr>
                    <td style="${centerStyle}">180</td>
                    <td style="${centerStyle}">210</td>
                    <td>V∆∞·ª£t ch·ªâ ti√™u</td>
                </tr>
                 <tr>
                    <td style="${centerStyle}">Mi·ªÅn Nam</td>
                    <td colspan="2" style="${centerStyle} background-color: #fff3cd;">300 (T·ªïng 6 th√°ng)</td>
                    <td>M·ªõi m·ªü r·ªông</td>
                </tr>
            </table>

            <br>
            
            <!-- 4. DYNAMIC TABLE (CODE BLOCK) -->
             <div style="font-size: 16px; font-weight: bold; color: #333; margin-bottom: 10px; border-bottom: 2px solid #6f42c1; display: inline-block;">4. B·∫£ng ƒê·ªông (Generated via Code Block)</div>
             <p>B·∫£ng d∆∞·ªõi ƒë√¢y ƒë∆∞·ª£c sinh ra t·ª´ ƒëo·∫°n script embedded:</p>
             <pre><code class="language-javascript">// eval
const headers = ["ID", "T√™n s·∫£n ph·∫©m", "Gi√° (USD)", "S·ªë L∆∞·ª£ng", "T·ªïng"];
const rows = [];

// T·∫°o 5 d√≤ng d·ªØ li·ªáu m·∫´u ng·∫´u nhi√™n
for (let i = 1; i <= 5; i++) {
    const price = Math.floor(Math.random() * 100) + 10;
    const qty = Math.floor(Math.random() * 10) + 1;
    rows.push([
        i, 
        "S·∫£n ph·∫©m " + String.fromCharCode(64 + i), 
        price, 
        qty, 
        price * qty
    ]);
}

// G·ªçi h√†m v·∫Ω b·∫£ng c·ªßa jsPDF wrapper
// pdf l√† instance c·ªßa JsPdfService ƒë∆∞·ª£c expose v√†o eval context
pdf.addTable(headers, rows, {
    margin: { left: 15 },
    theme: 'grid', // 'striped', 'grid', 'plain'
    styles: { fontSize: 10 },
    headStyles: { fillColor: [41, 128, 185], textColor: 255 }
});

pdf.addText("T·ªïng s·ªë d√≤ng ƒë√£ sinh: " + rows.length, 15, pdf.currentY + 10);
pdf.currentY += 15; // D·ªãch chuy·ªÉn con tr·ªè xu·ªëng ƒë·ªÉ kh√¥ng ghi ƒë√®
</code></pre>

        `;
        const bluePrint = window.DrawPDF.default.parseHtml(html);
        console.log("bluePrint", bluePrint);
        pdfInstance.setData(bluePrint);
      }

      function reviewPdf() {
        if (pdfInstance) {
          pdfInstance.getData(); // Sync data
          const blob = pdfInstance.getBlob();
          const url = URL.createObjectURL(blob);
          window.open(url, "_blank");
        }
      }
    </script>
  </body>
</html>
