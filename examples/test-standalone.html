<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DrawPDF Standalone Demo</title>
    
    <!-- 2. DrawPDF Standalone Build -->
    <script src="../dist/drawpdf.standalone.umd.cjs"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { margin-top: 0; color: #333; }
        
        .toolbar { margin-bottom: 20px; display: flex; gap: 10px; padding: 10px; background: #eee; border-radius: 4px; }
        .btn { padding: 10px 20px; color: white; border: none; cursor: pointer; border-radius: 4px; font-weight: 500; display: flex; align-items: center; gap: 6px; }
        .btn:hover { opacity: 0.9; }
        .btn-primary { background: #007bff; }
        .btn-success { background: #28a745; }
        .btn-info { background: #17a2b8; }
        .btn-secondary { background: #6c757d; }

        #editor-container { border: 1px solid #ccc; min-height: 400px; margin-bottom: 20px; }
        .ck-editor__editable { min-height: 400px; padding: 20px !important; }
        
        #preview-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000;
        }
        #preview-modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content {
            background: white; width: 90%; height: 90%; border-radius: 8px;
            display: flex; flex-direction: column; overflow: hidden;
        }
        .modal-header { padding: 15px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { flex: 1; padding: 0; background: #555; }
        iframe { width: 100%; height: 100%; border: none; }
        .close-btn { font-size: 24px; cursor: pointer; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>DrawPDF Standalone Demo</h1>
        <p>Phi√™n b·∫£n ch·∫°y tr·ª±c ti·∫øp file HTML, t∆∞∆°ng th√≠ch v·ªõi h∆∞·ªõng d·∫´n trong <a href="../README.md">README.md</a>.</p>

        <div class="toolbar">
            <button class="btn btn-primary" onclick="loadSampleData()">üìÇ Load Data M·∫´u</button>
            <button class="btn btn-info" onclick="showPreview()">üëÅÔ∏è Review (Xem tr∆∞·ªõc)</button>
            <button class="btn btn-success" onclick="printPdf()">üñ®Ô∏è Print / Download</button>
        </div>

        <div id="toolbar-container"></div>
        <div id="editor-container">
            <h2>H√ìA ƒê∆†N B√ÅN H√ÄNG</h2>
            <p style="text-align:right;">Ng√†y: {{today}}</p>
            <p><strong>Kh√°ch h√†ng:</strong> {{customerName}}</p>
            <p><strong>ƒê·ªãa ch·ªâ:</strong> {{customerAddress}}</p>

            <h3>Chi ti·∫øt ƒë∆°n h√†ng:</h3>
            <figure class="table">
                <table>
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>S·∫£n ph·∫©m</th>
                            <th>ƒê∆°n gi√°</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>{{#each items}}</td>
                            <td>- {{name}}</td>
                            <td>{{formatCurrency price}}</td>
                        </tr>
                        <tr>
                            <td>{{/each}}</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                    </tbody>
                </table>
            </figure>

            <p style="text-align:right;"><strong>T·ªïng ti·ªÅn: {{formatCurrency totalAmount}}</strong></p>
            
            <p><strong>Ghi ch√∫:</strong> {{#if isPaid}}ƒê√£ thanh to√°n{{else}}Ch∆∞a thanh to√°n{{/if}}</p>
            
            <hr>
            <p style="text-align:center;"><em>C·∫£m ∆°n qu√Ω kh√°ch!</em></p>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="preview-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Xem tr∆∞·ªõc PDF</h3>
                <span class="close-btn" onclick="closePreview()">&times;</span>
            </div>
            <div class="modal-body">
                <iframe id="pdf-frame"></iframe>
            </div>
        </div>
    </div>

    <script>
        let app;

        // Data m·∫´u (Demo variables, loops, conditionals)
        let currentData = {
            today: new Date().toLocaleDateString('vi-VN'),
            customerName: 'Nguy·ªÖn VƒÉn A',
            customerAddress: '123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM',
            items: [
                { name: 'S·∫£n ph·∫©m A', price: 100000 },
                { name: 'S·∫£n ph·∫©m B', price: 250000 },
                { name: 'D·ªãch v·ª• C', price: 500000 }
            ],
            totalAmount: 850000,
            isPaid: true
        };

        // Kh·ªüi t·∫°o ngay khi load trang
        window.onload = async () => {
            await initApp();
        };

        async function initApp() {
            try {
                // Debug logs
                console.log('--- Debug Info ---');
                console.log('DrawPDF Global:', DrawPDF);
                console.log('window.CKEDITOR:', window.CKEDITOR);
                console.log('window.DecoupledEditor:', window.DecoupledEditor);
                console.log('window.jspdf:', window.jspdf);
                console.log('------------------');

                // L·∫•y class t·ª´ file build (h·ªó tr·ª£ nhi·ªÅu ki·ªÉu export UMD)
                // UMD th∆∞·ªùng export d·∫°ng: { default: Class, DrawPDF: Class, ... }
                // Ho·∫∑c ƒë√¥i khi g√°n tr·ª±c ti·∫øp Class v√†o global n·∫øu ch·ªâ c√≥ 1 export default
                const DrawPDFClass = DrawPDF.default || DrawPDF.DrawPDF || DrawPDF;

                if (typeof DrawPDFClass.create !== 'function') {
                    console.error('Exports found:', Object.keys(DrawPDF));
                    throw new Error(`DrawPDFClass.create is not a function. Found typeof: ${typeof DrawPDFClass}`);
                }

                // Ki·ªÉm tra CKEditor manual check (ƒë·ªÉ debug r√µ h∆°n)
                if (!window.CKEDITOR && !window.DecoupledEditor) {
                     console.warn('‚ö†Ô∏è CKEDITOR not found on window. Attempting to locate in DrawPDF exports...');
                     // Fallback logic n·∫øu CKEditor ƒë∆∞·ª£c bundle k√®m nh∆∞ng ch∆∞a expose
                }

                // S·ª≠ d·ª•ng h√†m static create()
                app = await DrawPDFClass.create('#editor-container', {
                    toolbarContainer: '#toolbar-container'
                });
                    
                // L∆∞u global ƒë·ªÉ debug
                window.drawPdfApp = app;

                console.log('‚úÖ DrawPDF App Created!');
                console.log('üìò Xem README.md ƒë·ªÉ bi·∫øt th√™m c√°c h√†m API.');

            } catch (err) {
                console.error('L·ªói kh·ªüi t·∫°o chi ti·∫øt:', err);
                console.error('Stack trace:', err.stack);
                alert('L·ªói kh·ªüi t·∫°o: ' + (err.message || err));
            }
        }

        function loadSampleData() {
            const json = prompt('Nh·∫≠p JSON data:', JSON.stringify(currentData, null, 2));
            if (json) {
                try {
                    currentData = JSON.parse(json);
                    alert('ƒê√£ c·∫≠p nh·∫≠t data! H√£y b·∫•m Review.');
                } catch (e) {
                    alert('JSON kh√¥ng h·ª£p l·ªá!');
                }
            }
        }

        function showPreview() {
            if (!app) return;
            
            // L·∫•y blueprint m·ªõi nh·∫•t t·ª´ editor
            const blueprint = app.getData();
            
            // Render v√† l·∫•y Data URL
            // C√°ch 1: d√πng instance method
            const dataUrl = app.render(currentData);
            
            // C√°ch 2: d√πng method c·ªßa renderer (nh∆∞ c≈©)
            // app.renderer.render(blueprint, currentData);
            // const dataUrl = app.renderer.getDataUrl();

            document.getElementById('pdf-frame').src = dataUrl;
            document.getElementById('preview-modal').classList.add('show');
        }

        function printPdf() {
            if (!app) return;
            
            // Download file
            app.download('hoa-don.pdf', currentData);
        }

        function closePreview() {
            document.getElementById('preview-modal').classList.remove('show');
        }
    </script>
</body>
</html>
